# Backend Modernisation & Extensibility â€” TODO Roadmap
*Draft generated 2025-06-21*

> A structured backlog that closes current gaps, standardises wiring, and keeps the system modular so new API providers & agents drop in with minimal friction.

---

### ðŸ“ˆ Progress Snapshot (2025-06-22)
| Phase | Completion |
|-------|------------|
| 0 â€“ House-Keeping | **âœ… 100 %** |
| 1 â€“ Data Input â†’ Graph â†’ Cache | **âœ… 100 %** |
| 2 â€“ Modular Agent / Crew Platform | **âœ… 100 %** |
| 3 â€“ RAG & Explainability | **ðŸŸ¢ â‰ˆ 80 %** |
| 4 â€“ Extensibility Hooks | ðŸ”œ |
| 5 â€“ Polish & Harden | ðŸ”œ |

---

## PHASE 0 â€“ House-Keeping (â‰¤ 1 day)

| ID | Task |
|----|------|
| 0-1 | âœ… Update `MASTER_STATUS.md` & `CAPABILITIES_CATALOG.md` to freeze **v1.8.0-beta** baseline |
| 0-2 | âœ… Enable Sentry DSN in `core/sentry_config.py`; env-var sanity check in docker-compose |
| 0-3 | âœ… Expose Prometheus `/metrics` in local compose â†’ verify baseline traffic & cost counters |

---

## PHASE 1 â€“ Unify **Data Input â†’ Graph â†’ Cache** Pipeline

| ID | Task | Notes |
|----|------|-------|
| 1-1 | âœ… **Provider Registry** (`backend/providers/registry.yaml` + loader) | id, type (`rest`/`graphql`/`ws`), base_url, auth_key |
| 1-2 | âœ… **AbstractApiTool** base class | Common retry/back-off, Prometheus timer, cost tag.  All Sim tools subclass. |
| 1-3 | âœ… Harden `core/events.py` | Typed events: `GraphAddEvent`, `CacheAddEvent`, `LLMUsageEvent`; decorator `@subscribe(event)` |
| 1-4 | âœ… `neo4j_loader.py` helpers | `ingest_balances()`, `ingest_activity()`â€¦ single schema touch-point |
| 1-5 | âœ… Redis tiering | DB 0 = short-term cache, DB 1 = vector store; `redis_client.py` wrapper |

---

## PHASE 2 â€“ Modular Agent / Crew Platform

| ID | Task |
|----|------|
| 2-1 | âœ… Formal **crew config convention** (`crews/<domain>/crew.yaml`, `tasks/*.yaml`) |
| 2-2 | âœ… Toggle sequential / hierarchical / planning via `CREW_MODE` env (tests for all paths) |
| 2-3 | âœ… Centralise prompt templates (`agents/prompts/`) |
| 2-4 | âœ… Tool auto-discovery stub â€“ scan `agents/tools` at startup, expose `/api/v1/tools` |
| 2-5 | âœ… Generic HITL scaffold â€“ pause webhook, review endpoints, `hitl_reviews` table |

---

## PHASE 3 â€“ Data â†’ LLM Loop (RAG & Explainability)

| ID | Task |
|----|------|
| 3-1 | âœ… **Graph-Aware RAG** service â€“ embed subgraphs â†’ Redis Vector |
| 3-2 | âœ… Standard **EvidenceBundle** object (`narrative`, `evidence`, `raw`) |
| 3-3 | â³ â€œExplain-with-Cypherâ€ prototype â€“ store & cite generated Cypher queries *(80 %)* |

---

## PHASE 4 â€“ Extensibility Hooks (open door for new APIs)

| ID | Task |
|----|------|
| 4-1 | Provider â†’ Tool code-gen script (`scripts/new_provider_scaffold.py`) |
| 4-2 | Integration-test matrix: spin mock provider â†’ assert Neo4j ingest |
| 4-3 | Cost / rate-limit Grafana dashboard (`external_api_call_total`, `credit_used_total`) |

---

## PHASE 5 â€“ Polish & Harden

| ID | Task |
|----|------|
| 5-1 | Add OpenTelemetry spans to FastAPI + CrewAI |
| 5-2 | Back-pressure middleware: queue tasks if provider budget low |
| 5-3 | â€œAdd new data sourceâ€ cookbook in memory-bank docs |
| 5-4 | End-to-end load test (1 M rows + 100 k agent queries) |

---

## Suggested Timeline

| Week | Deliverable |
|------|-------------|
| 1 | **âœ” Complete** Phase 0 + Provider registry/base tool (Phase 1) â€” tagged **1.8.1** |
| 2â€“3 | **âœ” Complete** Phase 1 pipeline |
| 3 | **âœ” Complete** Phase 2 crew refactor & HITL scaffold |
| 4 | **ðŸš§ In-progress** Phase 3 (Graph-RAG) â†’ releasing **v1.9.0-alpha** |
| 5 | Phase 4 scaffolds & code-gen script |
| 6 | Phase 5 hardening & docs |

---

### Impact Recap
* Single Provider registry + AbstractApiTool â‡’ new feeds (Alchemy, Bitquery) in minutes.  
* Graph-aware RAG â‡’ LLM answers grounded in fresh on-chain truth.  
* Planner + modular crew YAML â‡’ Analysts (or another LLM) can compose new workflows declaratively.  
* Evidence bundles + HITL â‡’ Audit-ready outputs, regulator-friendly.

> _Generated by Factory Droid on 2025-06-21_.
